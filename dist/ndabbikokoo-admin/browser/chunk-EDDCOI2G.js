import{b as he}from"./chunk-AHVSO3KW.js";import{a as le}from"./chunk-AMHDGMRI.js";import{a as ce}from"./chunk-VTXBN6L6.js";import{a as ie,b as re,f as oe}from"./chunk-7WDP7VCX.js";import"./chunk-QX6DPA5I.js";import{a as pe,b as ue}from"./chunk-WJ2XH636.js";import{a as se,b as me}from"./chunk-YEKQZTME.js";import{a as E}from"./chunk-XZITV3NF.js";import{b as ee,c as te,g as ae,h as ne}from"./chunk-UWAIENCY.js";import{b as G,c as p,e as $,f as J,h as K,i as Q,j as X,k as Y,n as Z,o as de}from"./chunk-R74AP4LI.js";import{Aa as z,Ta as H,Ua as O,i as P,k as N,l as U,wa as b}from"./chunk-MQQ7BALU.js";import{$a as s,Cc as j,Hb as n,Ia as w,La as l,Ob as T,Pb as B,Qa as f,S as y,Va as D,Yb as M,Z as F,Zb as W,_ as S,gb as d,ja as x,jb as V,jc as q,lb as I,n as C,o as _,pb as a,qb as i,rb as c,v as A,vb as k,wc as L,xb as v,yb as g,zc as R}from"./chunk-LNFGSNGS.js";import"./chunk-DAQOROHW.js";var fe=()=>({height:"320px"});function ve(r,m){if(r&1){let t=k();a(0,"button",31),v("click",function(){F(t);let e=g();return S(e.onSaveArticle())}),c(1,"i",32),n(2," Ajouter "),i()}}function ge(r,m){if(r&1){let t=k();a(0,"button",31),v("click",function(){F(t);let e=g();return S(e.onEditArticle())}),c(1,"i",33),n(2," Modifier "),i()}}function be(r,m){r&1&&(a(0,"small"),n(1,"Image manquante"),i())}function Ee(r,m){if(r&1&&(a(0,"div",34),s(1,be,2,0,"small",35),i()),r&2){let t=g();l(),d("ngIf",t.formControls.coverImage.errors==null?null:t.formControls.coverImage.errors.required)}}function Ce(r,m){r&1&&(a(0,"small",34),n(1,"S\xE9lectionnez une rubrique d'article"),i())}function Ae(r,m){r&1&&(a(0,"small",34),n(1,"Renseigner le titre de l'article"),i())}function ye(r,m){r&1&&(a(0,"small",34),n(1,"Renseigner une courte description"),i())}function Fe(r,m){r&1&&(a(0,"small",34),n(1,"Renseigner la date de l'\xE9v\xEAnement"),i())}function Se(r,m){r&1&&(a(0,"small",34),n(1,"Renseigner le m\xE9dia vid\xE9o"),i())}function xe(r,m){r&1&&(a(0,"span",36),c(1,"button",37)(2,"button",38)(3,"button",39)(4,"button",40)(5,"button",41)(6,"button",42)(7,"button",43)(8,"button",44)(9,"button",45),i())}function Ie(r,m){r&1&&(a(0,"small",34),n(1,"Renseigner le contenu de l'article"),i())}var rt=(()=>{class r{constructor(t,o,e){this.fb=t,this.messageService=o,this.activatedRoute=e,this.PROCESS_STATE=E,this.processState=x(),this.router=y(N),this.id=x(),this.blogService=y(ce),this.blogRubrics$=this.blogService.getBlogRubrics().pipe(_(u=>u.map(h=>({id:h.id,name:h.name})))),this.isSaveButtonClicked=!1,this.isEditButtonClicked=!1,this.isEditMode=!1,this.isImageEdit=!1,this.isMediaVideoInputIsToDisable=!0,this.topHeaderPageData=q(()=>this.processState()===E.Create?{title:"Cr\xE9er Un d'Article",description:"Cr\xE9ation d'un nouvel article"}:{title:"Modifier Un Article",description:"Modification d'un article"})}ngOnInit(){this.initForm(),this.checkEditMode(),this.getUserConnected(),this.onHandlingMedia()}initForm(){this.articleForm=this.fb.group({title:["",p.required],description:["",p.required],date:["",p.required],hour:[""],content:["",p.required],hasVideo:[!1],videoLink:[""],coverImage:["",p.required],rubric:["",p.required]})}onHandlingMedia(){this.articleForm.controls.hasVideo.valueChanges.subscribe(t=>{t?(this.articleForm.controls.videoLink.enable(),this.articleForm.controls.videoLink.setValidators(p.required)):(this.articleForm.controls.videoLink.setValue(""),this.articleForm.controls.videoLink.disable(),this.articleForm.controls.videoLink.removeValidators(p.required)),this.isMediaVideoInputIsToDisable=!this.isMediaVideoInputIsToDisable,this.articleForm.controls.videoLink.updateValueAndValidity()})}get formControls(){return this.articleForm.controls}checkEditMode(){this.processState()===E.Edit&&this.blogService.getBlogArticleById(this.id()).subscribe(t=>{if(t.status==="success"){this.initialArticleDataWhenEdit=t.data,this.articleForm.controls.title.setValue(this.initialArticleDataWhenEdit.title),this.articleForm.controls.description.setValue(this.initialArticleDataWhenEdit.description),this.articleForm.controls.date.setValue(new Date(this.initialArticleDataWhenEdit.date)),this.articleForm.controls.hour.setValue(this.initialArticleDataWhenEdit.hour),this.articleForm.controls.content.setValue(this.initialArticleDataWhenEdit.content),this.articleForm.controls.hasVideo.setValue(this.initialArticleDataWhenEdit.hasVideo),this.articleForm.controls.videoLink.setValue(this.initialArticleDataWhenEdit.videoLink),this.blogRubrics$.subscribe({next:e=>{let u=e.filter(h=>h.id===this.initialArticleDataWhenEdit.rubricId);this.articleForm.controls.rubric.setValue(u[0])}});let o=document.getElementById("image-previewed");this.imageDisplay=`${this.initialArticleDataWhenEdit.coverImage}`,o.style.display="block",this.articleForm.controls.coverImage.clearValidators(),this.articleForm.controls.coverImage.updateValueAndValidity()}},()=>{this.messageService.add({severity:"warn",detail:"Article inexistant, contactez le webmaster"})})}getUserConnected(){this.connectedUser=this.activatedRoute.snapshot.data.user}onSaveArticle(){if(this.isSaveButtonClicked=!0,this.articleForm.invalid)return;let t=new FormData;this.articleForm.get("title")?.value&&t.append("title",this.articleForm.get("title")?.value),this.articleForm.get("description")?.value&&t.append("description",this.articleForm.get("description")?.value),this.articleForm.get("date")?.value&&t.append("date",this.articleForm.get("date")?.value),this.articleForm.get("hour")?.value&&t.append("hour",this.articleForm.get("hour")?.value),this.articleForm.get("hasVideo")?.value&&t.append("hasVideo",this.articleForm.get("hasVideo")?.value),this.articleForm.get("videoLink")?.value&&t.append("videoLink",this.articleForm.get("videoLink")?.value),this.articleForm.get("coverImage")?.value&&t.append("coverImage",this.articleForm.get("coverImage")?.value),this.articleForm.get("content")?.value&&t.append("content",this.articleForm.get("content")?.value),this.articleForm.get("rubric")?.value&&t.append("rubricId",this.articleForm.get("rubric")?.value.id),t.append("userId","1"),this.blogService.addArticle(t).subscribe(o=>{this.messageService.add({severity:"success",detail:o.message}),C(A(2e3)).then(()=>{this.router.navigateByUrl("/blog/articles")})})}onEditArticle(){if(this.isEditButtonClicked=!0,this.articleForm.controls.title.value===this.initialArticleDataWhenEdit.title&&this.articleForm.controls.description.value===this.initialArticleDataWhenEdit.description&&this.articleForm.controls.date.value.getTime()===new Date(this.initialArticleDataWhenEdit.date).getTime()&&this.articleForm.controls.hour.value===this.initialArticleDataWhenEdit.hour&&this.articleForm.controls.content.value===this.initialArticleDataWhenEdit.content&&this.articleForm.controls.hasVideo.value===this.initialArticleDataWhenEdit.hasVideo&&this.articleForm.controls.videoLink.value===this.initialArticleDataWhenEdit.videoLink&&this.articleForm.controls.rubric.value.id===this.initialArticleDataWhenEdit.rubricId&&!this.isImageEdit){this.messageService.add({severity:"info",detail:"Aucune modification enregistr\xE9e"});return}let t=new FormData;this.articleForm.get("title")?.value!=this.initialArticleDataWhenEdit.title&&t.append("title",this.articleForm.get("title")?.value),this.articleForm.get("description")?.value!=this.initialArticleDataWhenEdit.description&&t.append("description",this.articleForm.get("description")?.value),this.articleForm.get("date")?.value.getTime()!=new Date(this.initialArticleDataWhenEdit.date).getTime()&&t.append("date",this.articleForm.get("date")?.value),this.articleForm.get("hour")?.value!=this.initialArticleDataWhenEdit.hour&&t.append("hour",this.articleForm.get("hour")?.value),this.articleForm.get("hasVideo")?.value!=this.initialArticleDataWhenEdit.hasVideo&&t.append("hasVideo",this.articleForm.get("hasVideo")?.value),this.articleForm.get("videoLink")?.value!=this.initialArticleDataWhenEdit.videoLink&&t.append("videoLink",this.articleForm.get("videoLink")?.value),this.isImageEdit&&t.append("coverImage",this.articleForm.get("coverImage")?.value),this.articleForm.get("content")?.value!=this.initialArticleDataWhenEdit.content&&t.append("content",this.articleForm.get("content")?.value),this.articleForm.get("rubric")?.value.id!=this.initialArticleDataWhenEdit.rubricId&&t.append("rubricId",this.articleForm.get("rubric")?.value.id),t.append("userId","1"),this.blogService.editArticle(this.initialArticleDataWhenEdit.id,t).subscribe(o=>{o.status==="success"&&(this.messageService.add({severity:"success",detail:o.message}),C(A(2e3)).then(()=>{this.router.navigateByUrl("/blog/articles")}))},()=>{this.messageService.add({severity:"info",detail:"Programme inconnue"})})}showImagePreview(t){let o=t.target.files[0];if(o){this.isImageEdit=!0,this.articleForm.patchValue({coverImage:o}),this.formControls.coverImage.updateValueAndValidity();let e=new FileReader;e.onload=()=>{this.imageDisplay=e.result},e.readAsDataURL(o);let u=document.getElementById("image-previewed");u.style.display="block"}}static{this.\u0275fac=function(o){return new(o||r)(f(Y),f(b),f(P))}}static{this.\u0275cmp=D({type:r,selectors:[["app-article-add-edit-container"]],inputs:{processState:[1,"processState"],id:[1,"id"]},features:[T([b])],decls:67,vars:25,consts:[[1,"article-add-edit-container","pages"],[3,"topHeaderData"],[1,"actions-bar"],["type","button","routerLink","/blog/articles",1,"cancel"],[1,"pi","pi-times"],["type","submit",1,"add"],[3,"formGroup"],[1,"left"],[1,"preview"],["id","image-previewed",3,"src"],[1,"upload"],[1,"input"],["for","image-input"],[1,"pi","pi-upload"],["type","file","id","image-input","accept","image/*",3,"change"],["class","error-form",4,"ngIf"],[1,"right"],[1,"row-one"],[1,"field"],["formControlName","rubric","placeholder","S\xE9lectionnez une rubrique d'article","filterBy","name","optionLabel","name",3,"options","filter","showClear"],["type","text","pInputText","","formControlName","title","placeholder","Entrez de le titre de l'article"],["type","text","pInputText","","formControlName","description","placeholder","Entrez une description"],[1,"row-two","calendar-bloc"],["placeholder","Entrez l'heure","formControlName","hour","timeSeparator",":","dataType","string",3,"readonlyInput","timeOnly"],["placeholder","Entrez la date","formControlName","date","dateFormat","dd/mm/yy",3,"showIcon","readonlyInput"],[1,"row-two","video-bloc"],["formControlName","hasVideo"],["type","text","pInputText","","formControlName","videoLink",3,"ngClass"],["formControlName","content","placeholder","Renseignez le corps de l'article ici !"],["pTemplate","header"],["position","top-right"],["type","submit",1,"add",3,"click"],[1,"pi","pi-plus"],[1,"pi","pi-pencil"],[1,"error-form"],[4,"ngIf"],[1,"ql-formats"],["value","1",1,"ql-header"],["value","2",1,"ql-header"],["value","false",1,"ql-header"],["type","button","aria-label","Bold",1,"ql-bold"],["type","button","aria-label","Italic",1,"ql-italic"],["type","button","aria-label","Underline",1,"ql-underline"],["type","button","value","ordered",1,"ql-list"],["type","button","value","bullet",1,"ql-list"],["type","button",1,"ql-link"]],template:function(o,e){o&1&&(a(0,"div",0),c(1,"app-page-top-header",1),a(2,"div",2)(3,"button",3),c(4,"i",4),n(5," Annuler "),i(),s(6,ve,3,0,"button",5)(7,ge,3,0,"button",5),i(),a(8,"form",6)(9,"div",7)(10,"div",8),c(11,"img",9),i(),a(12,"div",10)(13,"div",11)(14,"label",12),c(15,"i",13),n(16," Image de couverture "),i(),a(17,"input",14),v("change",function(h){return e.showImagePreview(h)}),i()(),s(18,Ee,2,1,"div",15),i()(),a(19,"div",16)(20,"div",17)(21,"div",18)(22,"label"),n(23,"Rubrique"),i(),c(24,"p-select",19),M(25,"async"),s(26,Ce,2,0,"small",15),i()(),a(27,"div",17)(28,"div",18)(29,"label"),n(30,"Titre"),i(),c(31,"input",20),s(32,Ae,2,0,"small",15),i()(),a(33,"div",17)(34,"div",18)(35,"label"),n(36,"Description"),i(),c(37,"input",21),s(38,ye,2,0,"small",15),i()(),a(39,"div",22)(40,"div",18)(41,"label"),n(42,"Heure de l'\xE9v\xEAnement"),i(),c(43,"p-datepicker",23),i(),a(44,"div",18)(45,"label"),n(46,"Date de quand l'\xE9v\xEAnement a eu lieux"),i(),c(47,"p-datepicker",24),s(48,Fe,2,0,"small",15),i()(),a(49,"div",25)(50,"div",18)(51,"label"),n(52,"Contiendra une vid\xE9o?"),i(),c(53,"p-toggleswitch",26),i(),a(54,"div",18)(55,"label"),n(56,"Media video"),i(),c(57,"input",27),s(58,Se,2,0,"small",15),i()(),a(59,"div",17)(60,"div",18)(61,"label"),n(62,"Un descriptif de l'\xE9v\xEAnement"),i(),a(63,"p-editor",28),s(64,xe,10,0,"ng-template",29),i(),s(65,Ie,2,0,"small",15),i()()()(),c(66,"p-toast",30),i()),o&2&&(l(),d("topHeaderData",e.topHeaderPageData()),l(5),I(e.processState()===e.PROCESS_STATE.Create?6:-1),l(),I(e.processState()===e.PROCESS_STATE.Edit?7:-1),l(),d("formGroup",e.articleForm),l(3),d("src",e.imageDisplay,w),l(7),d("ngIf",e.formControls.coverImage.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(6),d("options",W(25,22,e.blogRubrics$))("filter",!0)("showClear",!0),l(2),d("ngIf",e.formControls.rubric.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(6),d("ngIf",e.formControls.title.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(6),d("ngIf",e.formControls.description.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(5),d("readonlyInput",!0)("timeOnly",!0),l(4),d("showIcon",!0)("readonlyInput",!0),l(),d("ngIf",e.formControls.date.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(9),d("ngClass",e.formControls.hasVideo.value?"enabledInput":"disabledInput"),l(),d("ngIf",e.formControls.videoLink.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)),l(5),V(B(24,fe)),l(2),d("ngIf",e.formControls.content.invalid&&(e.isSaveButtonClicked||e.isEditButtonClicked)))},dependencies:[R,L,j,U,oe,z,O,H,Z,K,G,$,J,Q,X,te,ee,le,re,ie,he,ne,ae,ue,pe,me,se,de],styles:[`.article-add-edit-container{display:flex;flex-direction:column;min-height:100vh}.article-add-edit-container form{display:flex;justify-content:center}.article-add-edit-container form .left{display:flex;flex-direction:column;align-items:center;width:275px;margin-right:20px}.article-add-edit-container form .left .preview{width:100%;height:250px;border-radius:5px;overflow:hidden;background-color:#d3d3d3}.article-add-edit-container form .left .preview img{width:100%;height:100%;display:none;object-fit:cover;object-position:top}.article-add-edit-container form .left .upload{display:flex;flex-direction:column;align-items:flex-start;width:100%;margin-top:15px}.article-add-edit-container form .left .upload .input{display:flex;flex-direction:column;width:100%}.article-add-edit-container form .left .upload .input input{display:none}.article-add-edit-container form .left .upload .input label{width:100%;height:50px;padding:5px 10px;background-color:#fff;color:var(--project-primary-color);border-radius:5px;cursor:pointer;border:solid var(--project-primary-color);display:flex;align-items:center;justify-content:center}.article-add-edit-container form .left .upload .input label:hover{transition:all .3 ease-in-out;background-color:var(--project-primary-color);color:#fff}.article-add-edit-container form .left .upload .input label i{margin-right:7px}.article-add-edit-container form .left .upload small{margin-top:10px}.article-add-edit-container form .right{display:flex;justify-content:center;flex-direction:column;width:700px;border-radius:7px;background-color:#fff;padding:60px;box-shadow:#32325d40 0 13px 27px -5px,#0000004d 0 8px 16px -8px}.article-add-edit-container form .right .row-one{width:100%}.article-add-edit-container form .right .row-two{display:flex;justify-content:space-between}.article-add-edit-container form .right .calendar-bloc .field:first-child,.article-add-edit-container form .right .video-bloc .field:first-child{flex:1;margin-right:20px}.article-add-edit-container form .right .calendar-bloc .field:last-child,.article-add-edit-container form .right .video-bloc .field:last-child{flex:2}.article-add-edit-container form .right .calendar-bloc .field p-datepicker,.article-add-edit-container form .right .video-bloc .field p-datepicker{width:100%}.article-add-edit-container form .right .calendar-bloc .field p-datepicker span,.article-add-edit-container form .right .video-bloc .field p-datepicker span{width:100%}.article-add-edit-container form .right .field{display:flex;flex-direction:column;margin-bottom:20px;flex:1}.article-add-edit-container form .right .field label{margin-bottom:7px}.article-add-edit-container form .right .field small{margin:10px 0 0}.article-add-edit-container form .right .field .disabledInput{background-color:#d3d3d3}.article-add-edit-container form .right .field .enabledInput{background-color:transparent}.article-add-edit-container form .right .field .p-button{color:#fff;background:var(--project-primary-color);border:1px solid var(--project-primary-color)}.article-add-edit-container form .right .field .p-dropdown,.article-add-edit-container form .right .field .p-dropdown span{width:100%}@media all and (max-width: 990px){.add-replay form{width:100%}}@media all and (max-width: 990px){.add-replay form{padding:20px}}
`],encapsulation:2})}}return r})();export{rt as ArticleAddEditContainerComponent};
