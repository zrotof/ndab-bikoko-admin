import{a as f,d as T,e as w,k as b}from"./chunk-U6Q63N2R.js";import{J as s,M as m,R as l,f as h,g as d,o as g}from"./chunk-LNFGSNGS.js";function c(o){this.message=o}c.prototype=new Error,c.prototype.name="InvalidCharacterError";var v=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(o){var r=String(o).replace(/=+$/,"");if(r.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var e,t,i=0,n=0,p="";t=r.charAt(n++);~t&&(e=i%4?64*e+t:t,i++%4)?p+=String.fromCharCode(255&e>>(-2*i&6)):0)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t);return p};function y(o){var r=o.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(v(e).replace(/(.)/g,function(t,i){var n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}(r)}catch{return v(r)}}function a(o){this.message=o}function k(o,r){if(typeof o!="string")throw new a("Invalid token specified");var e=(r=r||{}).header===!0?0:1;try{return JSON.parse(y(o.split(".")[e]))}catch(t){throw new a("Invalid token specified: "+t.message)}}a.prototype=new Error,a.prototype.name="InvalidTokenError";var u=k;var U=(()=>{class o{constructor(e,t){this.router=e,this.http=t,this.baseUrlAuth=f.baseUrl+"users/",this.isLogged$=new d(!1),this.user$=new h,this._logoutTimeout=null,this.httpOptions={headers:new T({"Content-Type":"application/json"})}}login(e){return this.http.post(this.baseUrlAuth+"login/",e,this.httpOptions).pipe(g(t=>t.data),s(t=>this.setTokenToLocalStorage(t)),s(t=>{let i=u(t),n=i.exp-i.iat;console.log("payload.exp - payload.iat : ",i.exp-i.iat),this.setExpirationCounter(n)}))}logout(){localStorage.removeItem("token"),this.isLogged$.next(!1),this.clearLogoutTimeout(),this.router.navigate(["/se-connecter"])}getConnectedUserId(){let e=this.getToken();return u(e).sub}setTokenToLocalStorage(e){localStorage.setItem("token",e)}getToken(){return localStorage.getItem("token")}setExpirationCounter(e){let t=e*1e3;this.clearLogoutTimeout(),this._logoutTimeout=setTimeout(()=>{this.logout()},t)}clearLogoutTimeout(){this._logoutTimeout&&(clearTimeout(this._logoutTimeout),this._logoutTimeout=null)}static{this.\u0275fac=function(t){return new(t||o)(l(b),l(w))}}static{this.\u0275prov=m({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{u as a,U as b};
